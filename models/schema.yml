version: 2

sources:
  - name: raw
    schema: gz_raw_data
    description: greenweez row data source
    tables:
      - name: raw_gz_product
        description: product of greenweez / we have one row per products_id and we get the purchase price of the product (which is different from its selling price).
        columns:
          - name: products_id
            description: the unique identifier of the product.
            tests:
              - unique
              - not_null
          - name: purchse_price
            description: the purchase price of the product.

      - name: raw_gz_sales
        description: sales of greenweez / we have one row per products_id found in each orders_is.
        tests:
              - unique:
                  column_name: "(orders_id || '-' || pdt_id)"
        columns:
          - name: date_date
            description: the date of purchase
          - name: orders_id
            description: the unique identifier of the order/transaction.
          - name: pdt_id
            description: the unique identifier of the product in the order. A single product id appears only once in an order.
          - name: revenue
            description: the total income generated by a business through its sales of goods or services.
          - name: quantity
            description: the quantity of products purchased.
      - name: raw_gz_ship
        description: ship of greenweez / We have all the information about the shipping costs and the cost of the shipment or log. There is one line per order with its associated costs and fees.
        columns:
          - name: orders_id
            description: the unique identifier of the order.
            tests:
              - unique
              - not_null
          - name: shipping_fee
            description: the price the customer pays for shipping.
          - name: logcost
            description: the cost of preparing the parcel in the warehouse.
          - name: ship_cost
            description: the shipping cost paid by Greenweez to the carrier/transporter.

      - name: raw_gz_adwords
        description: raw_gz_adwords table
        tests:
              - unique:
                  column_name: "(campaign_key || '-' || date_date)"
              - not_null
        columns:
          - name: date_date
            description: the date of purchase
          - name: paid_source
            description: The source from which the ad was paid for
          - name: campaign_key
            description: The unique identifier for the ad campaign. 
          - name: camPGN_name
            description: The name or title of the ad campaign
          - name: ads_cost
            description: The cost incurred for running the ad campaign
          - name: impression
            description: The number of times the ad was displayed to users.
          - name: click
            description: The number of times users clicked on the ad

      - name: raw_gz_bing
        description: raw_gz_bing table
        tests:
              - unique:
                  column_name: "(campaign_key || '-' || date_date)"
              - not_null
        columns:
          - name: date_date
            description: the date of purchase
          - name: paid_source
            description: The source from which the ad was paid for
          - name: campaign_key
            description: The unique identifier for the ad campaign. 
          - name: camPGN_name
            description: The name or title of the ad campaign
          - name: ads_cost
            description: The cost incurred for running the ad campaign
          - name: impression
            description: The number of times the ad was displayed to users.
          - name: click
            description: The number of times users clicked on the ad

      - name: raw_gz_criteo
        description: raw_gz_criteo table
        tests:
              - unique:
                  column_name: "(campaign_key || '-' || date_date)"
              - not_null
        columns:
          - name: date_date
            description: the date of purchase
          - name: paid_source
            description: The source from which the ad was paid for
          - name: campaign_key
            description: The unique identifier for the ad campaign. 
          - name: camPGN_name
            description: The name or title of the ad campaign
          - name: ads_cost
            description: The cost incurred for running the ad campaign
          - name: impression
            description: The number of times the ad was displayed to users.
          - name: click
            description: The number of times users clicked on the ad

      - name: raw_gz_facebook
        description: raw_gz_facebook table
        tests:
              - unique:
                  column_name: "(campaign_key || '-' || date_date)"
              - not_null
        columns:
          - name: date_date
            description: the date of purchase
          - name: paid_source
            description: The source from which the ad was paid for
          - name: campaign_key
            description: The unique identifier for the ad campaign. 
          - name: camPGN_name
            description: The name or title of the ad campaign
          - name: ads_cost
            description: The cost incurred for running the ad campaign
          - name: impression
            description: The number of times the ad was displayed to users.
          - name: click
            description: The number of times users clicked on the ad


models:
  - name: stg_raw__product
  - name: stg_raw__sales
  - name: stg_raw__ship
  - name: stg_raw__raw_gz_facebook
  - name: stg_raw__raw_gz_criteo
  - name: stg_raw__raw_gz_adwords
  - name: stg_raw__raw_gz_bing
  - name: int_sales_margin
    description: margin calcultation per order line / product sale
    columns:
      - name: margin
        description: Margin = Revenue - Purchase_cost
      - name: Purchase_cost
        description: Purchase_cost = Quantity * Purchase_price 
  - name: int_orders_margin
    description: margin calcultation per order 
    columns:
      - name: orders_id
        description: primary key
      - name: margin
        description: Margin = Revenue - Purchase_cost
      - name: Purchase_cost
        description: Purchase_cost = Quantity * Purchase_price 
      - name: date_date
        description: date of the order
      - name: revenue
        description: sum of revenue per order 
      - name: quantity
        description: sum of quantity per order
  - name: int_orders_operational
    description: operational margin calcultation per order 
    columns:
      - name: operational_margin 
        description: Operational margin = margin + shipping fee - log_cost - ship_cost
  - name: finance_days
    description: finance calculation per days
  - name : int_campaigns
    description: union of bing & facebook & adwords & criteo
  - name : int_campaigns_day
    description:  aggregated version of int_campaigns model 
  - name : finance_campaigns_day
    description: compagin finance_days and int_campaigns_day
  - name: finance_campaigns_month
    description: aggregated version of finance_campaigns_day for each month


# models:
#   - name: int_sales_margin
#     description: 
#       This model calculates the margin for each product sold based on the sales data.
#     columns:
#       - name: date_date
#         description: The date of the sales transaction.
#         tests:
#           - not_null
#       - name: orders_id
#         description: The unique identifier of the sales order.
#         tests:
#           - not_null
#       - name: products_id
#         description: The unique identifier of the product.
#         tests:
#           - unique:
#           - not_null
#       - name: revenue
#         description: The total revenue generated by the sale.
#         tests:
#           - not_null
#       - name: quantity
#         description: The quantity of products sold in the transaction.
#         tests:
#           - not_null
#       - name: purchase_price
#         description: The purchase price of the product.
#         tests:
#           - not_null
#       - name: purchase_cost
#         description: The total purchase cost of the products sold.
#         tests:
#           - not_null
#       - name: margin
#         description: The margin generated from the sale.
#         tests:
#           - not_null

#   - name: int_orders_margin
#     description: 
#       This model calculates the margin for each sales order based on the sales data.
#     columns:
#       - name: orders_id
#         description: The unique identifier of the sales order.
#         tests:
#           - unique:
#           - not_null
#       - name: date_date
#         description: The date of the sales transaction.
#         tests:
#           - not_null
#       - name: revenue
#         description: The total revenue generated by the sales order.
#         tests:
#           - not_null
#       - name: quantity
#         description: The total quantity of products sold in the sales order.
#         tests:
#           - not_null
#       - name: purchase_cost
#         description: The total purchase cost of the products sold in the sales order.
#         tests:
#           - not_null
#       - name: margin
#         description: The total margin generated from the sales order.
#         tests:
#           - not_null

#   - name: int_orders_operational
#     description: 
#       This model calculates the operational margin for each sales order based on the sales and shipping data.
#     columns:
#       - name: orders_id
#         description: The unique identifier of the sales order.
#         tests:
#           - unique
#           - not_null
#       - name: date_date
#         description: The date of the sales transaction.
#         tests:
#           - not_null
#       - name: operational_margin
#         description: The operational margin of the sales order.
#         tests:
#           - not_null
#       - name: revenue
#         description: The total revenue generated by the sales order.
#         tests:
#           - not_null
#       - name: quantity
#         description: The total quantity of products sold in the sales order.
#         tests:
#           - not_null
#       - name: purchase_cost
#         description: The total purchase cost of the products sold in the sales order.
#         tests:
#           - not_null
#       - name: margin
#         description: The total margin generated from the sales order.
#         tests:
#           - not_null

#   - name: finance_days
#     description: 
#       This model calculates financial metrics aggregated by date.
#     columns:
#       - name: date_date
#         description: The date for which the financial metrics are calculated.
#         tests:
#           - unique
#           - not_null
#       - name: nb_transaction
#         description: The number of sales transactions on the date.
#         tests:
#           - not_null
#       - name: revenue
#         description: The total revenue generated on the date.
#         tests:
#           - not_null        
#       - name: average_basket
#         description: The average basket size on the date.
#         tests:
#           - not_null
#       - name: margin
#         description: The total margin generated on the date.
#         tests:
#           - not_null
#       - name: operational_margin
#         description: The total operational margin generated on the date.
#         tests:
#           - not_null
#       - name: quantity
#         description: The total quantity of products sold on the date.
#         tests:
#           - not_null
#       - name: purchase_cost
#         description: The total purchase cost of the products sold on the date.
#         tests:
#           - not_null



